<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quick Position Calc</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{margin:0;padding:0;box-sizing:border-box}
html{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
body{background:#0d0d0d;color:#eee;line-height:1.4;min-height:100vh;padding:12px 8px}

:root{
  --bg:#0d0d0d;--card:#1a1a1a;--border:#333;
  --accent:#f0b90b;--green:#00ff9d;--red:#ff0066;--yellow:#ffff00;
  --radius:16px;--gap:12px;
}

.container{max-width:1100px;margin:0 auto;display:grid;gap:var(--gap);grid-template-columns:1fr}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;overflow:hidden}

h1{font-size:28px;font-weight:800;text-align:center;color:var(--accent);margin-bottom:8px}
.input-imp{background:#333 !important;border:2px solid var(--accent) !important;font-size:18px !important;font-weight:700;padding:14px !important}
input, button{font-size:16px !important}

label{font-size:14px;color:#aaa;margin-bottom:4px;display:block}
input[type=number],input[type=text]{
  background:#222;color:#fff;border:1px solid #444;padding:12px 14px;border-radius:10px;transition:all .2s;
}
input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(240,185,11,.3);outline:none}

.toggle-group{display:flex;background:#222;border-radius:10px;overflow:hidden;margin:6px 0}
.toggle-btn{flex:1;padding:10px;font-size:13px;font-weight:600;color:#aaa;background:transparent;border:none;cursor:pointer}
.toggle-btn.active{background:var(--accent);color:#000;font-weight:800}

.range-row{display:flex;align-items:center;gap:12px;background:#222;padding:12px;border-radius:10px;margin:8px 0}
#levVal{font-size:20px;font-weight:800;color:var(--accent);min-width:66px;text-align:center}

.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 20px;border:none;border-radius:12px;font-weight:700;cursor:pointer;font-size:16px}
.btn-calc{background:var(--accent);color:#000;flex:1}
.btn-save{background:#333;color:var(--yellow);border:2px solid var(--yellow);padding:14px 16px}

.direction{display:grid;grid-template-columns:1fr 1fr;font-size:36px;font-weight:900;text-align:center;padding:20px 0;border-radius:var(--radius);margin:12px 0}
.long{background:rgba(0,255,157,.2);color:var(--green);border:3px solid var(--green)}
.short{background:rgba(255,0,102,.2);color:var(--red);border:3px solid var(--red)}

.result-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:12px}
.res-item{background:#111;padding:14px;border-radius:12px;font-size:15px}
.res-label{font-size:12px;color:#888}
.res-value{font-size:20px;font-weight:800;margin-top:4px}
.highlight{color:var(--accent)}

.warning{background:rgba(255,0,102,.25);color:var(--red);padding:16px;border-radius:12px;text-align:center;font-weight:700;font-size:18px;margin-top:12px}

@media(min-width:768px){
  .container{grid-template-columns:1fr 1fr;grid-template-areas:"input result""saved saved"}
  #inputArea{grid-area:input}
  #resultArea{grid-area:result}
  #savedArea{grid-area:saved}
}
</style>
</head>
<body>

<div class="container">
  <h1>Quick Position Calculator</h1>

  <!-- INPUT -->
  <div class="card" id="inputArea">
    <div style="display:flex;gap:8px;margin-bottom:12px;">
      <input type="number" id="acc" placeholder="Balance USDT" class="input-imp">
      <input type="number" id="rp" placeholder="Risk %" value="1" class="input-imp" style="display:block">
      <input type="number" id="ra" placeholder="Risk USDT" class="input-imp" style="display:none">
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
      <div>
        <label>Entry Price</label>
        <input type="number" id="e" placeholder="30000" class="input-imp">
      </div>
      <div>
        <label>Stop Loss</label>
        <input type="number" id="sp" placeholder="29800" class="input-imp">
      </div>
    </div>

    <div style="margin:12px 0">
      <label>Leverage</label>
      <div class="range-row">
        <input type="range" id="lev" min="1" max="125" value="20">
        <div id="levVal">20x</div>
      </div>
    </div>

    <div style="display:flex;gap:8px;">
      <button class="btn btn-calc" onclick="calc()">CALCULATE</button>
      <button class="btn btn-save" onclick="quickSave()">SAVE POSITION</button>
    </div>
  </div>

  <!-- RESULT -->
  <div class="card" id="resultArea">
    <div id="directionPlaceholder" style="color:#666;text-align:center;padding:40px 0">Nhập dữ liệu →</div>
    <div id="resultContent" style="display:none"></div>
  </div>

  <!-- SAVED POSITIONS -->
  <div class="card" id="savedArea" style="margin-top:12px">
    <div style="font-weight:700;color:var(--accent);margin-bottom:8px">Vị thế đã lưu gần nhất</div>
    <div id="quickList"></div>
  </div>
</div>

<script>
let currentData = {};

const els = {
  acc:()=>document.getElementById('acc'),
  rp:()=>document.getElementById('rp'),
  e:()=>document.getElementById('e'),
  sp:()=>document.getElementById('sp'),
  lev:()=>document.getElementById('lev'),
  levVal:()=>document.getElementById('levVal'),
  direction:()=>document.getElementById('directionPlaceholder'),
  result:()=>document.getElementById('resultContent'),
  list:()=>document.getElementById('quickList')
};

els.lev().oninput = () => {
  els.levVal().textContent = els.lev().value + 'x';
  calc();
};

function calc(){
  const acc = parseFloat(els.acc().value) || 0;
  const riskPct = parseFloat(els.rp().value) || 1;
  const entry = parseFloat(els.e().value) || 0;
  const sl = parseFloat(els.sp().value) || 0;
  const lev = parseFloat(els.lev().value) || 1;

  if(!acc || !entry || !sl || acc<=0 || entry<=0 || sl<=0){
    els.result().style.display='none';
    els.direction().innerHTML = 'Nhập đầy đủ dữ liệu';
    return;
  }

  const riskAmt = acc * riskPct / 100;
  const isLong = sl < entry;
  const distance = Math.abs(entry - sl);
  const size = riskAmt / distance;
  const posValue = size * entry;
  const margin = posValue / lev;
  const liq = isLong ? entry - (margin / size) : entry + (margin / size);

  currentData = {acc, riskPct, entry, sl, lev, riskAmt, size, posValue, margin, liq, isLong, ts:Date.now()};

  // Direction badge lớn
  els.direction().innerHTML = isLong ?
    '<div class="direction long">LONG</div>' :
    '<div class="direction short">SHORT</div>';

  // Result
  const rr = sl && entry ? (distance / entry * 100).toFixed(2) : 0;
  els.result().style.display = 'block';
  els.result().innerHTML = `
    <div class="result-grid">
      <div class="res-item"><div class="res-label">Position Value</div><div class="res-value highlight">$${posValue.toFixed(0)}</div></div>
      <div class="res-item"><div class="res-label">Margin</div><div class="res-value">$${margin.toFixed(1)}</div></div>
      <div class="res-item"><div class="res-label">SL Distance</div><div class="res-value ${isLong?'text-green':'text-red'}">${rr}%</div></div>
      <div class="res-item"><div class="res-label">Liquidation</div><div class="res-value" style="color:#ff9900">${liq.toFixed(4)}</div></div>
      <div class="res-item"><div class="res-label">Risk / Margin</div><div class="res-value ${(riskAmt/margin*100)>90?'color:red':''}">${(riskAmt/margin*100).toFixed(1)}%</div></div>
      <div class="res-item"><div class="res-label">Size</div><div class="res-value">${size.toFixed(4)}</div></div>
    </div>
    ${(riskAmt/margin*100)>90 ? '<div class="warning">CẢNH BÁO: Rủi ro >90% margin → rất dễ quét SL!</div>' : ''}
  `;
  renderQuickList();
}

function quickSave(){
  if(!currentData.entry) return alert('Chưa có vị thế để lưu');
  let saved = JSON.parse(localStorage.quickPositions || '[]');
  saved.unshift({
    name: `${currentData.isLong?'LONG':'SHORT'} ${currentData.entry} @${new Date().toLocaleTimeString('vi-VN')}`,
    data: currentData
  });
  if(saved.length>20) saved.pop();
  localStorage.quickPositions = JSON.stringify(saved);
  renderQuickList();
  alert('Đã lưu vị thế nhanh!');
}

function renderQuickList(){
  let saved = JSON.parse(localStorage.quickPositions || '[]');
  els.list().innerHTML = saved.length===0 ? 
    '<div style="text-align:center;color:#666;padding:20px">Chưa có vị thế nào</div>' :
    saved.map(p=>`
      <div style="background:#222;padding:12px;border-radius:12px;margin:8px 0;display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="color:var(--accent);font-weight:700">${p.name}</div>
          <div style="font-size:13px;color:#aaa">
            ${p.data.posValue.toFixed(0)}$ • ${p.data.margin.toFixed(1)}$ margin • ${p.data.lev}x
          </div>
        </div>
        <button onclick="loadQuick('${saved.indexOf(p)}')" style="background:var(--accent);color:#000;padding:8px 12px;border-radius:8px;font-weight:700">Load</button>
      </div>
    `).join('');
}

function loadQuick(idx){
  let saved = JSON.parse(localStorage.quickPositions || '[]');
  let d = saved[idx].data;
  els.acc().value = d.acc;
  els.rp().value = d.riskPct;
  els.e().value = d.entry;
  els.sp().value = d.sl;
  els.lev().value = d.lev;
  els.levVal().textContent = d.lev + 'x';
  calc();
}

// Auto calculate khi nhập
document.querySelectorAll('input').forEach(i=>i.addEventListener('input',()=>setTimeout(calc,100)));

// Load lần đầu
window.onload = ()=>{ calc(); renderQuickList(); }
</script>
</body>
</html>